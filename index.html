<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ピーキング計算ツール</title>
  <style>
    body { font-family: sans-serif; background: #f5f5f5; padding: 20px; }
    .container { background: #fff; padding: 20px; border-radius: 8px; max-width: 600px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 20px; padding: 10px; font-size: 1em; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    .error { border: 2px solid red; }
  </style>
</head>
<body>

<div class="container">
  <h2>ピーキング計算ツール</h2>

  <label for="weight">体重(kg)</label>
  <input type="number" id="weight" step="0.1">

  <label for="bodyfat">体脂肪率(%)</label>
  <input type="number" id="bodyfat" step="0.1" onchange="updateFatOption()">

  <label for="calories">摂取カロリー(kcal)</label>
  <input type="number" id="calories" placeholder="TDEEを基準に設定">

  <label for="protein">たんぱく質量(g/kg)</label>
  <select id="protein">
    <option value="2.0">2.0g</option>
    <option value="2.2">2.2g</option>
    <option value="2.3" selected>2.3g</option>
    <option value="2.5">2.5g</option>
  </select>

  <label for="fat">脂質量 (g/kg)</label>
  <select id="fat">
    <option value="0.6">0.6g</option>
    <option value="0.7" selected>0.7g</option>
    <option value="0.8">0.8g</option>
  </select>

  <label for="sensitivity">感受性</label>
  <select id="sensitivity">
    <option value="very-high">すごい浮腫む</option>
    <option value="high">浮腫む</option>
    <option value="normal" selected>普通</option>
    <option value="low">浮腫まない</option>
    <option value="very-low">全く浮腫まない</option>
  </select>

  <label for="days">ピーキング期間（日数）</label>
  <select id="days">
    <option value="10">10日</option>
    <option value="7">7日</option>
    <option value="5">5日</option>
    <option value="3">3日</option>
  </select>

  <label for="phase">ピーキングフェーズ</label>
  <select id="phase">
    <option value="depletion">ディプリート（カーボ制限）</option>
    <option value="carb-up">カーボアップ（炭水化物補充）</option>
  </select>

  <label for="water">水分量 (L) (感受性基準)</label>
  <input type="number" id="water" step="0.1" placeholder="自動設定も可能">

  <label for="salt">塩分量 (g) (感受性基準)</label>
  <input type="number" id="salt" step="0.1" placeholder="自動設定も可能">

  <button onclick="calculate()">計算する</button>

  <table id="output" style="display:none;">
    <thead>
      <tr>
        <th>栄養素</th>
        <th>量</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>たんぱく質 (g)</td><td id="protein-out"></td></tr>
      <tr><td>脂質 (g)</td><td id="fat-out"></td></tr>
      <tr><td>炭水化物 (g)</td><td id="carb-out"></td></tr>
      <tr><td>摂取カロリー (kcal)</td><td id="calories-out"></td></tr>
      <tr><td>水分量 (L)</td><td id="water-out"></td></tr>
      <tr><td>塩分量 (g)</td><td id="salt-out"></td></tr>
    </tbody>
  </table>

</div>

<script>
function updateFatOption() {
  const bodyfat = parseFloat(document.getElementById("bodyfat").value);
  let fatValue = 0.7; // Default value

  if (bodyfat <= 5) {
    fatValue = 0.9; // 体脂肪率が5%以下の場合は脂質を0.9g/kgに設定
  } else if (bodyfat >= 10 && bodyfat < 20) {
    fatValue = 0.6; // 体脂肪率が6〜10%の場合は脂質を0.6g/kgに設定
  } else if (bodyfat >= 20) {
    fatValue = 0.3; // 体脂肪率が20%以上の場合は脂質を0.3g/kgに設定（極限まで少なく）
  }

  // 自動設定された脂質量を選択肢として反映
  document.getElementById("fat").value = fatValue;
}

function calculate() {
  const weight = parseFloat(document.getElementById("weight").value);
  const bodyfat = parseFloat(document.getElementById("bodyfat").value);
  const calories = parseFloat(document.getElementById("calories").value);
  const proteinMultiplier = parseFloat(document.getElementById("protein").value);
  const fatMultiplier = parseFloat(document.getElementById("fat").value);
  const sensitivity = document.getElementById("sensitivity").value;
  const phase = document.getElementById("phase").value;

  // 基本的なTDEE（基礎代謝 + 活動レベル）を計算
  const tdee = weight * 24; // 基本的な目安として1kgあたりの消費カロリーを24kcalに設定（例）
  
  let adjustedCalories = calories; // 最初はユーザーが入力したカロリー
  if (phase === "depletion") {
    adjustedCalories = tdee * 0.7;  // ディプリート期間中はカロリーを30%削減
  } else if (phase === "carb-up") {
    adjustedCalories = tdee * 1.2;  // カーボアップ期間中はカロリーを20%増加
  }

  // 除脂肪体重（LBM）を計算
  const lbm = weight * (1 - bodyfat / 100);  // 除脂肪体重
  const protein = lbm * proteinMultiplier;  // たんぱく質g
  const fat = lbm * fatMultiplier;         // 脂質g

  // カロリー配分
  const pCal = protein * 4;  // たんぱく質カロリー
  const fCal = fat * 9;      // 脂質カロリー
  const cCal = adjustedCalories - (pCal + fCal); // 残りのカロリーを炭水化物に割り振る
  const carb = cCal / 4;     // 炭水化物量(g)

  // 結果を表示
  document.getElementById("protein-out").innerText = Math.round(protein) + " g";
  document.getElementById("fat-out").innerText = Math.round(fat) + " g";
  document.getElementById("carb-out").innerText = Math.round(carb) + " g";
  document.getElementById("calories-out").innerText = Math.round(adjustedCalories) + " kcal";

  document.getElementById("output").style.display = "table";
}
</script>

</body>
</html>