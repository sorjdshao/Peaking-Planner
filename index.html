<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ピーキング戦略（前日まで）</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #fff; margin: 0; padding: 20px; }
    .container { max-width: 900px; margin: auto; background: #1a1a1a; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px #000; }
    label { display: block; margin-top: 12px; font-weight: bold; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: none; }
    button { margin-top: 20px; padding: 10px 20px; background: #f39c12; color: #000; font-weight: bold; border: none; border-radius: 6px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 16px; }
    th, td { border: 1px solid #444; padding: 6px; text-align: center; }
    th { background: #333; }
    .day-block { margin-top: 40px; }
    .error { border: 2px solid red; }
    @media print {
      button { display: none; }
      body { background: #fff; color: #000; }
      table { page-break-inside: avoid; }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>ピーキング戦略（前日まで）</h1>

  <label>体重（kg）</label>
  <input id="weight" type="number" placeholder="例: 70">

  <label>体脂肪率（％）</label>
  <input id="bodyfat" type="number" placeholder="例: 15">

  <label>TDEE（1日の消費カロリー）</label>
  <input id="tdee" type="number" placeholder="例: 2500">

  <label>ピーキング日数</label>
  <select id="days">
    <option value="3">3日間</option>
    <option value="5">5日間</option>
    <option value="7" selected>7日間</option>
  </select>

  <label>食事回数</label>
  <select id="meals">
    <option value="3">3回</option>
    <option value="4">4回</option>
    <option value="5" selected>5回</option>
    <option value="6">6回</option>
  </select>

  <label>起床時間</label>
  <input id="wakeTime" type="time">

  <label>水分感受性</label>
  <select id="waterSens">
    <option value="low">低</option>
    <option value="medium" selected>中</option>
    <option value="high">高</option>
  </select>

  <label>塩分感受性</label>
  <select id="saltSens">
    <option value="low">低</option>
    <option value="medium" selected>中</option>
    <option value="high">高</option>
  </select>

  <label>カロリー戦略（ディプリート時）</label>
  <select id="calorieStrategy">
    <option value="adjust" selected>カロリーを減らす</option>
    <option value="maintain_p">維持（Pのみ）</option>
    <option value="maintain_f">維持（Fのみ）</option>
    <option value="maintain_p_strong">維持（P多め）</option>
    <option value="maintain_f_strong">維持（F多め）</option>
  </select>

  <button onclick="generate()">スケジュール表示</button>
  <div id="output"></div>
</div>

<script>
function generate() {
  const weight = parseFloat(document.getElementById("weight").value);
  const bodyfat = parseFloat(document.getElementById("bodyfat").value);
  const tdee = parseFloat(document.getElementById("tdee").value);
  const days = parseInt(document.getElementById("days").value);
  const meals = parseInt(document.getElementById("meals").value);
  const [h, m] = document.getElementById("wakeTime").value.split(":").map(Number);
  const waterSens = document.getElementById("waterSens").value;
  const saltSens = document.getElementById("saltSens").value;
  const strategy = document.getElementById("calorieStrategy").value;

  const lean = weight * (1 - bodyfat / 100);
  const baseP = Math.round(lean * 2.3);
  const fatMin = 30;
  const waterAdj = { low: 1.2, medium: 1.0, high: 0.8 }[waterSens];
  const saltAdj = { low: 1.2, medium: 1.0, high: 0.8 }[saltSens];

  const tdeeRatios = {
    3: [0.8, 0.6, 1.2],
    5: [0.8, 0.7, 0.6, 1.0, 1.2],
    7: [0.9, 0.8, 0.7, 0.6, 1.0, 1.1, 1.2]
  }[days];

  const out = document.getElementById("output");
  out.innerHTML = "";

  tdeeRatios.forEach((ratio, i) => {
    const cal = Math.round(tdee * ratio);
    const pKcal = baseP * 4;
    const fKcal = fatMin * 9;
    let remain = cal - pKcal - fKcal;
    let extraP = 0, extraF = 0;

    if (strategy !== "adjust") {
      switch (strategy) {
        case "maintain_p": extraP = Math.round(remain / 4); break;
        case "maintain_f": extraF = Math.round(remain / 9); break;
        case "maintain_p_strong":
          extraP = Math.round(remain * 0.7 / 4); extraF = Math.round(remain * 0.3 / 9); break;
        case "maintain_f_strong":
          extraP = Math.round(remain * 0.3 / 4); extraF = Math.round(remain * 0.7 / 9); break;
      }
    }

    const totalP = baseP + extraP;
    const totalF = fatMin + extraF;
    const usedKcal = totalP * 4 + totalF * 9;
    const carb = Math.max(Math.round((cal - usedKcal) / 4), 0);

    const pMeal = Math.round(totalP / meals);
    const fMeal = Math.round(totalF / meals);
    const cMeal = Math.round(carb / meals);

    let table = "";
    let t = new Date(0, 0, 0, h, m);
    const interval = Math.floor(14 * 60 / (meals - 1));

    for (let j = 0; j < meals; j++) {
      const time = t.toTimeString().slice(0, 5);
      table += `<tr><td>${time}</td><td>食事${j + 1}</td><td>${pMeal}g</td><td>${fMeal}g</td><td>${cMeal}g</td></tr>`;
      t.setMinutes(t.getMinutes() + interval);
    }

    const water = Math.max(weight * 0.08 - i * 0.5, 1.5) * waterAdj;
    const salt = Math.max(weight * 0.2 - i * 2, 2) * saltAdj;

    out.innerHTML += `
      <div class="day-block">
        <h2>Day ${i + 1}（${cal} kcal / 水分 ${water.toFixed(1)}L / 塩分 ${salt.toFixed(1)}g）</h2>
        <table>
          <thead><tr><th>時間</th><th>内容</th><th>P</th><th>F</th><th>C</th></tr></thead>
          <tbody>${table}</tbody>
        </table>
        <p><strong>※備考：</strong> 吸収の速い糖（ラムネ、グルコース）をパンプ前に！</p>
      </div>`;
  });
}
</script>
</body>
</html>