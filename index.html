<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>前日までピーキングツール</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; padding: 20px; }
    .container { max-width: 700px; background: white; margin: auto; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    label, select, input { display: block; width: 100%; margin-bottom: 10px; font-size: 1rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background: #eee; }
    button { background: #28a745; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer; width: 100%; font-size: 1.1rem; }
  </style>
</head>
<body>
<div class="container">
  <h2>前日までピーキング計算ツール</h2>

  <label>体重（kg）<input type="number" id="weight"></label>
  <label>体脂肪率（%）<input type="number" id="bodyfat"></label>
  <label>活動レベル
    <select id="activity">
      <option value="28">低（×28）</option>
      <option value="30" selected>中（×30）</option>
      <option value="33">高（×33）</option>
    </select>
  </label>
  <label>ピーキング日数
    <select id="peakingDays">
      <option>10</option>
      <option>7</option>
      <option>5</option>
      <option>3</option>
    </select>
  </label>
  <label>現在のフェーズ日数<input type="number" id="daysRemaining"></label>
  <label>感受性
    <select id="sensitivity">
      <option value="very-high">すごい浮腫む</option>
      <option value="high">浮腫む</option>
      <option value="normal" selected>普通</option>
      <option value="low">浮腫まない</option>
      <option value="very-low">全く浮腫まない</option>
    </select>
  </label>

  <button onclick="calculate()">計算する</button>

  <table id="results" style="display:none">
    <thead>
      <tr><th>項目</th><th>値</th></tr>
    </thead>
    <tbody>
      <tr><td>総摂取カロリー</td><td id="calories"></td></tr>
      <tr><td>たんぱく質</td><td id="protein"></td></tr>
      <tr><td>脂質</td><td id="fat"></td></tr>
      <tr><td>炭水化物</td><td id="carbs"></td></tr>
      <tr><td>PFC比率</td><td id="pfc"></td></tr>
      <tr><td>水分量</td><td id="water"></td></tr>
      <tr><td>塩分量</td><td id="salt"></td></tr>
      <tr><td>フェーズ</td><td id="phase"></td></tr>
      <tr><td>備考</td><td id="note"></td></tr>
    </tbody>
  </table>
</div>

<script>
function calculate() {
  const weight = parseFloat(document.getElementById('weight').value);
  const bf = parseFloat(document.getElementById('bodyfat').value);
  const activity = parseFloat(document.getElementById('activity').value);
  const daysRemaining = parseInt(document.getElementById('daysRemaining').value);
  const sensitivity = document.getElementById('sensitivity').value;

  const lbm = weight * (1 - bf / 100);
  const tdee = weight * activity;

  let phase = daysRemaining <= 3 ? "カーボアップ" : "ディプリート";
  let baseRatio = bf >= 10 ? 0.75 : (bf >= 5 ? 0.95 : 1.05);
  let phaseRatio = phase === "ディプリート" ? 0.8 : 1.2;
  const calories = tdee * baseRatio * phaseRatio;

  const protein = lbm * 2.3;
  let fatRate = 0.7;
  if (phase === "ディプリート") {
    if (bf < 5) fatRate = 0.6;
    else if (bf > 10) fatRate = 0.9;
  } else {
    fatRate = 0.35;
  }
  const fat = lbm * fatRate;
  let carbs = phase === "ディプリート" ? weight * 1.1 : weight * 6.0;

  const pCal = protein * 4;
  const fCal = fat * 9;
  const cCal = carbs * 4;
  const totalCal = pCal + fCal + cCal;
  const pPct = Math.round((pCal / totalCal) * 100);
  const fPct = Math.round((fCal / totalCal) * 100);
  const cPct = Math.round((cCal / totalCal) * 100);

  const waterSaltMap = {
    "very-high": [1.5, 2.0, 2.0, 2.5],
    "high": [2.0, 2.5, 2.5, 3.0],
    "normal": [2.5, 3.0, 3.5, 4.0],
    "low": [3.0, 4.0, 4.0, 5.0],
    "very-low": [3.5, 4.5, 4.5, 5.5]
  };
  const [dw, ds, cw, cs] = waterSaltMap[sensitivity];
  const water = phase === "ディプリート" ? dw : cw;
  const salt = phase === "ディプリート" ? ds : cs;

  const note = phase === "ディプリート" ? "脂肪燃焼優先、水分補給を欠かさず。" : "パンプ重視、前日夜に炭水化物を補給。";

  document.getElementById('calories').textContent = `${Math.round(calories)} kcal`;
  document.getElementById('protein').textContent = `${Math.round(protein)} g`;
  document.getElementById('fat').textContent = `${Math.round(fat)} g`;
  document.getElementById('carbs').textContent = `${Math.round(carbs)} g`;
  document.getElementById('pfc').textContent = `P:${pPct}% / F:${fPct}% / C:${cPct}%`;
  document.getElementById('water').textContent = `${water.toFixed(1)} L`;
  document.getElementById('salt').textContent = `${salt.toFixed(1)} g`;
  document.getElementById('phase').textContent = phase;
  document.getElementById('note').textContent = note;
  document.getElementById('results').style.display = 'table';
}
</script>
</body>
</html>
