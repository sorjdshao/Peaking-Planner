<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>前日までピーキングツール</title>
  <style>
    body { font-family: sans-serif; background: #f5f5f5; padding: 20px; }
    .container { background: #fff; padding: 20px; border-radius: 8px; max-width: 600px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 20px; padding: 10px; font-size: 1em; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    .error { border: 2px solid red; }
  </style>
</head>
<body>

<div class="container">
  <h2>前日までピーキング計算ツール</h2>

  <label for="weight">体重(kg)</label>
  <input type="number" id="weight" step="0.1">

  <label for="bodyfat">体脂肪率(%)</label>
  <input type="number" id="bodyfat" step="0.1">

  <label for="calories">摂取カロリー(kcal)</label>
  <input type="number" id="calories">

  <label for="protein">たんぱく質量(g/kg)</label>
  <select id="protein">
    <option value="2.0">2.0g</option>
    <option value="2.2">2.2g</option>
    <option value="2.3" selected>2.3g</option>
    <option value="2.5">2.5g</option>
  </select>

  <label for="fat">脂質量 (g/kg)</label>
  <select id="fat">
    <option value="0.6">0.6g</option>
    <option value="0.7" selected>0.7g</option>
    <option value="0.8">0.8g</option>
  </select>

  <label for="sensitivity">感受性</label>
  <select id="sensitivity">
    <option value="very-high">すごい浮腫む</option>
    <option value="high">浮腫む</option>
    <option value="normal" selected>普通</option>
    <option value="low">浮腫まない</option>
    <option value="very-low">全く浮腫まない</option>
  </select>

  <button onclick="calculate()">計算する</button>

  <table id="output" style="display:none;">
    <thead>
      <tr>
        <th>栄養素</th>
        <th>量</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>たんぱく質 (g)</td><td id="protein-out"></td></tr>
      <tr><td>脂質 (g)</td><td id="fat-out"></td></tr>
      <tr><td>炭水化物 (g)</td><td id="carb-out"></td></tr>
      <tr><td>水分量 (L)</td><td id="water-out"></td></tr>
      <tr><td>塩分量 (g)</td><td id="salt-out"></td></tr>
    </tbody>
  </table>

</div>

<script>
function calculate() {
  const weight = parseFloat(document.getElementById("weight").value);
  const bodyfat = parseFloat(document.getElementById("bodyfat").value);
  const calories = parseFloat(document.getElementById("calories").value);
  const proteinMultiplier = parseFloat(document.getElementById("protein").value);
  const fatMultiplier = parseFloat(document.getElementById("fat").value);
  const sensitivity = document.getElementById("sensitivity").value;

  // 入力エラーチェック
  if (isNaN(weight) || isNaN(bodyfat) || isNaN(calories)) {
    ["weight", "bodyfat", "calories"].forEach(id => {
      const element = document.getElementById(id);
      if (isNaN(parseFloat(element.value))) {
        element.classList.add("error");
      } else {
        element.classList.remove("error");
      }
    });
    alert("すべての項目を正しく入力してください。");
    return;
  } else {
    ["weight", "bodyfat", "calories"].forEach(id => {
      document.getElementById(id).classList.remove("error");
    });
  }

  const lbm = weight * (1 - bodyfat / 100);  // 除脂肪体重
  const protein = lbm * proteinMultiplier;  // たんぱく質g
  const fat = lbm * fatMultiplier;         // 脂質g
  const pCal = protein * 4;
  const fCal = fat * 9;
  const cCal = calories - (pCal + fCal);
  const carb = cCal / 4;                   // 炭水化物g

  // 感受性による水・塩分設定
  let water, salt;
  switch (sensitivity) {
    case "very-high":
      water = weight * 0.035;
      salt = 2.5;
      break;
    case "high":
      water = weight * 0.04;
      salt = 3.0;
      break;
    case "normal":
      water = weight * 0.045;
      salt = 4.0;
      break;
    case "low":
      water = weight * 0.05;
      salt = 5.0;
      break;
    case "very-low":
      water = weight * 0.055;
      salt = 5.5;
      break;
  }

  // 最低保証
  if (water < 1.5) water = 1.5;
  if (salt < 2) salt = 2;

  // 小数点1桁に丸め
  function round1(value) {
    return Math.round(value * 10) / 10;
  }

  document.getElementById("protein-out").innerText = round1(protein) + " g";
  document.getElementById("fat-out").innerText = round1(fat) + " g";
  document.getElementById("carb-out").innerText = round1(carb) + " g";
  document.getElementById("water-out").innerText = round1(water) + " L";
  document.getElementById("salt-out").innerText = round1(salt) + " g";

  document.getElementById("output").style.display = "table";
}
</script>

</body>
</html>